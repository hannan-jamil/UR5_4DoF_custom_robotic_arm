<?xml version="1.0"?>
<robot
  name="ur5_4dof"
  xmlns:xacro="http://ros.org/wiki/xacro">

  <!-- === 1) UR5 4-DOF === -->

  <!-- Base -->
  <link name="base_link">
    <!-- Minimal Inertial block -->
    <inertial>
      <mass value="5.0"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia
        ixx="0.1" ixy="0.0" ixz="0.0"
        iyy="0.1" iyz="0.0"
        izz="0.1"/>
    </inertial>
    <!-- Simple Collision block (same mesh as visual) -->
    <collision>
      <origin xyz="0 0 0.003" rpy="0 0 2.35619449"/>
      <geometry>
        <mesh filename="package://ur_description/meshes/ur5/visual/base.dae"/>
      </geometry>
    </collision>
    <visual>
      <geometry>
        <mesh filename="package://ur_description/meshes/ur5/visual/base.dae"/>
      </geometry>
      <!-- 3·π/4 = 2.35619449 rad -->
      <origin xyz="0 0 0.003" rpy="0 0 2.35619449"/>
    </visual>
  </link>

  <!-- Joint 1 -->
  <joint name="shoulder_pan_joint" type="revolute">
    <parent link="base_link"/>
    <child  link="shoulder_link"/>
    <origin xyz="0 0 0.089159" rpy="0 0 0"/>
    <axis  xyz="0 0 1"/>
    <limit lower="-6.28318531" upper="6.28318531" effort="150" velocity="3.14159265"/>
  </joint>
  <link name="shoulder_link">
    <inertial>
      <mass value="4.0"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia
        ixx="0.08" ixy="0.0" ixz="0.0"
        iyy="0.08" iyz="0.0"
        izz="0.08"/>
    </inertial>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://ur_description/meshes/ur5/visual/shoulder.dae"/>
      </geometry>
    </collision>
    <visual>
      <geometry>
        <mesh filename="package://ur_description/meshes/ur5/visual/shoulder.dae"/>
      </geometry>
    </visual>
  </link>

  <!-- Joint 2 -->
  <joint name="shoulder_lift_joint" type="revolute">
    <parent link="shoulder_link"/>
    <child  link="upper_arm_link"/>
    <!-- π/2 = 1.57079633 rad -->
    <origin xyz="0 0.13585 0" rpy="0 1.57079633 0"/>
    <axis  xyz="0 1 0"/>
    <limit lower="-6.28318531" upper="6.28318531" effort="150" velocity="3.14159265"/>
  </joint>
  <link name="upper_arm_link">
    <inertial>
      <mass value="3.0"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia
        ixx="0.06" ixy="0.0" ixz="0.0"
        iyy="0.06" iyz="0.0"
        izz="0.06"/>
    </inertial>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://ur_description/meshes/ur5/visual/upperarm.dae"/>
      </geometry>
    </collision>
    <visual>
      <geometry>
        <mesh filename="package://ur_description/meshes/ur5/visual/upperarm.dae"/>
      </geometry>
    </visual>
  </link>

  <!-- Joint 3 -->
  <joint name="elbow_joint" type="revolute">
    <parent link="upper_arm_link"/>
    <child  link="forearm_link"/>
    <origin xyz="0 -0.1197 0.425" rpy="0 0 0"/>
    <axis  xyz="0 1 0"/>
    <limit lower="-6.28318531" upper="6.28318531" effort="150" velocity="3.14159265"/>
  </joint>
  <link name="forearm_link">
    <inertial>
      <mass value="2.5"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia
        ixx="0.05" ixy="0.0" ixz="0.0"
        iyy="0.05" iyz="0.0"
        izz="0.05"/>
    </inertial>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://ur_description/meshes/ur5/visual/forearm.dae"/>
      </geometry>
    </collision>
    <visual>
      <geometry>
        <mesh filename="package://ur_description/meshes/ur5/visual/forearm.dae"/>
      </geometry>
    </visual>
  </link>

  <!-- Joint 4 (combined wrist) -->
  <joint name="wrist_joint" type="revolute">
    <parent link="forearm_link"/>
    <child  link="wrist_link"/>
    <origin xyz="0 0 0.39225" rpy="0 0 0"/>
    <axis  xyz="0 1 0"/>
    <limit lower="-3.14159265" upper="0.78539816" effort="28" velocity="3.14159265"/>
  </joint>
  <link name="wrist_link">
    <inertial>
      <mass value="2.0"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia
        ixx="0.04" ixy="0.0" ixz="0.0"
        iyy="0.04" iyz="0.0"
        izz="0.04"/>
    </inertial>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://ur_description/meshes/ur5/visual/wrist1.dae"/>
      </geometry>
    </collision>
    <visual>
      <geometry>
        <mesh filename="package://ur_description/meshes/ur5/visual/wrist1.dae"/>
      </geometry>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </visual>
  </link>

  <!-- Fixed end-effector mount on the UR5 wrist -->
  <joint name="ee_fixed_joint" type="fixed">
    <parent link="wrist_link"/>
    <child link="ee_link"/>
    <origin xyz="0 0 0.17695" rpy="0 0 0"/>
  </joint>
  <link name="ee_link">
    <inertial>
      <mass value="1.5"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia
        ixx="0.03" ixy="0.0" ixz="0.0"
        iyy="0.03" iyz="0.0"
        izz="0.03"/>
    </inertial>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <!-- no mesh since ee_link has no visual itself -->
      <geometry>
        <box size="0.05 0.05 0.05"/>
      </geometry>
    </collision>
  </link>

  <!-- mounting gripper directly to ee_link -->
  <joint name="gripper_mount_joint" type="fixed">
    <parent link="ee_link"/>
    <child  link="grip_mount_link"/>
    <origin xyz="0 0.0943 -0.134" rpy="0 0 0"/>
  </joint>
  <link name="grip_mount_link">
    <inertial>
      <mass value="1.0"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia
        ixx="0.02" ixy="0.0" ixz="0.0"
        iyy="0.02" iyz="0.0"
        izz="0.02"/>
    </inertial>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <box size="0.03 0.02 0.02"/>
      </geometry>
    </collision>
  </link>

  <!-- === 1) Gripper Camera === -->

  <link name="gripper_camera_link">
    <inertial>
      <mass value="0.5"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <inertia
        ixx="0.005" ixy="0.0" ixz="0.0"
        iyy="0.005" iyz="0.0"
        izz="0.005"/>
    </inertial>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="package://ur5_4dof/meshes/camera.dae"
              scale="0.0025 0.0024 0.0012"/>
      </geometry>
    </collision>
    <visual>
      <geometry>
        <mesh filename="package://ur5_4dof/meshes/camera.dae"
              scale="0.0025 0.0024 0.0012"/>
      </geometry>
      <material name="CameraBody">
        <color rgba="0.1 0.6 0.9 1.0"/>
      </material>
    </visual>
  </link>

  <joint name="gripper_camera_joint" type="fixed">
    <parent link="grip_mount_link"/>
    <child  link="gripper_camera_link"/>
    <!--
      We shift:
        +X (forward)  0.00 m
        +Y (left)     0.04 m
        +Z (up)       0.05 m
      And tilt by –10° around its local Y axis
    -->
    <origin xyz="0.0317 0.0205 0.111" rpy="0.0 -0.26179 1.5693"/>
  </joint>

  <gazebo reference="gripper_camera_link">
    <sensor type="camera" name="gazebo_camera">
      <always_on>1</always_on>
      <update_rate>30.0</update_rate>
      <camera>
        <horizontal_fov>1.047</horizontal_fov>
        <image>
          <width>640</width>
          <height>480</height>
          <format>R8G8B8</format>
        </image>
        <clip>
          <near>0.1</near>
          <far>100.0</far>
        </clip>
      </camera>
      <plugin name="gazebo_ros_camera" filename="libgazebo_ros_camera.so">
        <ros>
          <namespace>/camera</namespace>
        </ros>
        <cameraName>gazebo_camera</cameraName>
        <imageTopicName>image_raw</imageTopicName>
        <cameraInfoTopicName>camera_info</cameraInfoTopicName>
        <frameName>gripper_camera_link</frameName>
      </plugin>
    </sensor>
  </gazebo>

  <!-- including and instantiating the Hand-E -->
  <xacro:include filename="$(find robotiq_hande_description)/urdf/robotiq_hande_gripper.xacro"/>
  <xacro:robotiq_hande_gripper
    name="gripper"
    prefix=""
    parent="grip_mount_link"
    use_fake_hardware="true"
    grip_pos_min="0.0"
    grip_pos_max="0.04"
    tty="/dev/ttyUSB0"
    baudrate="115200"
    parity="N"
    data_bits="8"
    stop_bit="1"
    slave_id="9"/>
</robot>

